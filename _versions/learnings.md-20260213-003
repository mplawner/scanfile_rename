# Learnings

- 2026-02-12: Added `pypdf` dependency so the tool can write classic PDF DocumentInfo metadata (Info dictionary) rather than XMP.
- 2026-02-13: Added CLI parse-time validation helper `_positive_int()` and new `--keywords-count` flag (default 5) with subprocess-based unit tests using `--version` to avoid invoking Poppler/LM Studio.
- 2026-02-13: Extended LLM prompt schema with `author`, `subject`, and `keywords` (bounded by `--keywords-count`) and added tolerant post-processing for `subject`/`keywords` in `extract_information()`.
- 2026-02-13: Added pure metadata formatting helpers (`pretty_title_from_filename`, `pdf_creation_date_from_ymd`, `format_keywords`) with unit tests.
- 2026-02-13: Tweaked `pretty_title_from_filename` to preserve unpadded date tokens like `YYYY-M-D`.
- 2026-02-13: Added `write_pdf_metadata_in_place()` helper that rewrites DocumentInfo via `pypdf.PdfWriter(clone_from=...)` with atomic `os.replace`, skipping encrypted and likely-signed PDFs.
- 2026-02-13: `pypdf.PdfReader.is_encrypted` can remain true after a successful `decrypt("")`; treat decrypt success by attempting page access instead of re-checking `is_encrypted`.
- 2026-02-13: Metadata writing should happen after the output file exists (post `shutil.copy2`/`shutil.move`), and must be best-effort (never fail the run).
- 2026-02-13: Added hermetic unit tests for `write_pdf_metadata_in_place()` (happy path, encrypted skip, signed skip) and for keyword truncation in `extract_information()`; refactored signature detection into module-level `_pdf_appears_signed()` to make signed detection patchable.
